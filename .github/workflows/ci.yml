# This workflow is triggered on every push to 'main' and every Pull Request.
# It performs continuous integration by installing dependencies, running the
# build process, and executing tests across multiple Node.js versions.

name: React App CI / Test

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build-and-test:
    # ----------------------------------------------------
    # 1. SETUP MATRIX STRATEGY
    # The matrix runs the job multiple times with different variables.
    # This ensures compatibility across different Node.js environments.
    # ----------------------------------------------------
    strategy:
      matrix:
        # We test on Node 18 (older LTS), 20 (current LTS), and 22 (latest stable)
        node-version: [20.x, 22.x]
      # Fail the overall run immediately if any single version fails
      fail-fast: true 

    runs-on: ubuntu-latest
    
    steps:
      - name: ‚¨áÔ∏è Checkout Repository Code
        uses: actions/checkout@v4
      
      - name: üõ†Ô∏è Setup Node.js ${{ matrix.node-version }}
        # Installs the correct Node version for the current matrix iteration
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}
          cache: 'npm' # Speeds up subsequent runs
          
      - name: üì• Install Dependencies
        # 'npm ci' is used for clean, reliable installs in CI environments
        run: npm ci
        
      - name: ‚öôÔ∏è 1. Run Build Check
        # This step verifies the code compiles (important for Vite/React)
        # It catches syntax errors, casing issues, and dependency problems.
        run: npm run build --if-present
        
      - name: üß™ 2. Run All Tests
        # This executes the "test": "npx vitest" script defined in your package.json
        # This is the quality gate for your application logic.
        run: npm test

      # ----------------------------------------------------
      # Optional: You can add more steps here, like linting or deployment triggers.
      # ----------------------------------------------------

